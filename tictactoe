#include <iostream>
#include <string>
#include <limits>

using namespace std;

void display_fields(char fields[]) { // вывод полей
    cout << endl;
    for (int i = 0; i < 9; i++) {
        if (i == 3 || i == 6) {
            cout << endl;
            cout << "----------";
            cout << endl;
        }

        cout << fields[i];

        if (i != 2 && i != 5 && i != 8) {
            cout << " | ";
        } 
    }
    cout << endl;
    cout << endl;
}

void new_move(char fields[], char player) { // новый ход
    int field;
    bool not_entered = true;

    while (not_entered) {
        cout << player << " move: ";
        cin >> field;
        // проверка на корректность ввода и не занято ли поле
        if (cin.fail() || field < 1 || field > 9 || fields[field - 1] == 'X' || fields[field - 1] == 'O') {
            cout << endl << "Invalid input or field is occupied. Try again" << endl << endl;
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n'); 
        } else {
            fields[field - 1] = player;
            not_entered = false;
        }
    }
}

void display_winner(char player) { // сообщение о победителе
    cout << "-------------" << endl;
    cout << "   " << player << " wins!" << endl;
    cout << "-------------" << endl;
}

bool check_winner(char fields[], char player) {
    bool result = false;

    // проверка всех 8 возможных вариантов победы
    if (fields[0] == fields[1] && fields[1] == fields[2]) {
        display_fields(fields);
        display_winner(player);
        result = true;
    }
    if (fields[3] == fields[4] && fields[4] == fields[5]) {
        display_fields(fields);
        display_winner(player);
        result = true;
    }
    if (fields[6] == fields[7] && fields[7] == fields[8]) {
        display_fields(fields);
        display_winner(player);
        result = true;
    }

    if (fields[0] == fields[3] && fields[3] == fields[6]) {
        display_fields(fields);
        display_winner(player);
        result = true;
    }
    if (fields[1] == fields[4] && fields[4] == fields[7]) {
        display_fields(fields);
        display_winner(player);
        result = true;
    }
    if (fields[2] == fields[5] && fields[5] == fields[8]) {
        display_fields(fields);
        display_winner(player);
        result = true;
    }

    if (fields[0] == fields[4] && fields[4] == fields[8]) {
        display_fields(fields);
        display_winner(player);
        result = true;
    }
    if (fields[2] == fields[4] && fields[4] == fields[6]) {
        display_fields(fields);
        display_winner(player);
        result = true;
    }

    return result;
}

int main() {
    char fields[9] = {'1', '2', '3', '4', '5', '6', '7', '8', '9'};
    int move = 0; // четный ход - крестик, нечетный - нолик
    char player; 

    cout << endl << "----- TIC TAC TOE -----" << endl;

    while (move < 8) {
        if (move % 2 == 0) { 
            player = 'X';
        } else {
            player = 'O';
        }

        display_fields(fields); // выводит поля
        new_move(fields, player); // запрос нового хода
        if (move > 3) {
            if (check_winner(fields, player)) { // проверка на победителя
                break;
            } 
        }
        move++; // след. ход если игра не завершена
    }

    if (move == 8) { // после 8 хода объявляется ничья
        display_fields(fields);
        cout << "-----------" << endl;
        cout << "   " << "Draw!" << endl;
        cout << "-----------" << endl;
    }

    return 0;
}
